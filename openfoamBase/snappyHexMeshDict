/*--------------------------------*- C++ -*----------------------------------*\
  =========                 |
  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
   \\    /   O peration     | Website:  https://openfoam.org
    \\  /    A nd           | Version:  11
     \\/     M anipulation  |
\*---------------------------------------------------------------------------*/
FoamFile
{
    format      ascii;
    class       dictionary;
    object      snappyHexMeshDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

castellatedMesh yes;
snap            yes;
addLayers       no;

geometry
{
	model
	{
		type triSurfaceMesh;
        file "model.stl";
	}
	
	inlet0
	{
		type triSurfaceMesh;
        file "inlet0.stl";
	}
	
	outlet0
	{
		type triSurfaceMesh;
        file "outlet0.stl";
	}
	
	outlet1
	{
		type triSurfaceMesh;
        file "outlet1.stl";
	}
	
	bry_free
	{
		type triSurfaceMesh;
        file "bry_free.stl";
	}
}

castellatedMeshControls
{
  maxLocalCells 10000000;
  maxGlobalCells 100000000;
  minRefinementCells 0;
  maxLoadUnbalance 0.5;
  nCellsBetweenLevels 3;
  resolveFeatureAngle 30;
  
  features (
  	{
  		file "inlet0.obj";
        levels ((1 1));
    }

    {
    	file "outlet0.obj";
        levels ((1 1));
    }

    {
        file "outlet1.obj";
        levels ((1 1));
    }

    {
        file "bry_free.obj";
        levels ((1 1));
    }
  );
  
  refinementSurfaces {
  	inlet0
    {
      patchInfo { type patch; }
      level (0 0);
    }
    
    outlet0
    {
      patchInfo { type patch; }
      level (0 0);
    }
    
    outlet1
    {
      patchInfo { type patch; }
      level (0 0);
    }
    
    bry_free
    {
      patchInfo { type wall; }
      level (0 0);
    }
    
  }
  
  refinementRegions {
  	model
  	{
  		mode inside;
        levels ((1000000000 1));
    }
  }
  
  allowFreeStandingZoneFaces yes;
  
  insidePoint (-0.0112347 0.000402537 -0.0126704);
}

snapControls
{
	// Number of patch smoothing iterations before finding correspondence to surface
	nSmoothPatch 3;
	
	nSmoothInternal 3;
	
	// Maximum relative distance for points to be attracted by surface.
    // True distance is this factor times local maximum edge length.
    // Note: changed(corrected) w.r.t 17x! (17x used 2* tolerance)
	tolerance 3;
	
	// Number of mesh displacement relaxation iterations.
	nSolveIter 30;
	
	// Maximum number of snapping relaxation iterations. Should stop before upon reaching a correct mesh.
	nRelaxIter 5;
	
	// Detect (geometric only) features by sampling the surface (default=false).
	implicitFeatureSnap false;
	
	// Use castellatedMeshControls::features (default = true)
	explicitFeatureSnap true;
	
	// Number of feature edge snapping iterations. Leave out altogether to disable.
	nFeatureSnapIter 15;
	
	// Detect features between multiple surfaces (only for explicitFeatureSnap, default = false)
	multiRegionFeatureSnap false;
  
	concaveAngle 45;
	minAreaRatio 0.3;
}

addLayersControls
{
	layers {}
	
	nGrow 0;
	featureAngle 120;
	maxFaceThicknessRatio 0.5;
	nSmoothSurfaceNormals 1;
	nSmoothThickness 10;
	minMedialAxisAngle 90;
	maxThicknessToMedialRatio 0.3;
	nSmoothNormals 3;
	nRelaxIter 10;
	nBufferCellsNoExtrude 0;
	nLayerIter 50;
	nRelaxedIter 20;
	thicknessModel finalAndExpansion;
	
	relativeSizes on;
	expansionRatio 1.2;
	finalLayerThickness 0.5;
	minThickness 0.3;
}

meshQualityControls
{
	maxNonOrtho 65;
	maxBoundarySkewness 20;
	maxInternalSkewness 4;
	maxConcave 80;
	minVol 1e-13;
	minTetQuality 1e-9;
	minVolCollapseRatio -1;
	minArea -1;
	minTwist 0.02;
	minDeterminant 0.001;
	minFaceWeight 0.05;
	minFaceFlatness -1;
	minVolRatio 0.01;
	minTriangleTwist -1;
	relaxed
	{
		maxNonOrtho 75;
	}
	nSmoothScale 4;
	errorReduction 0.75;
}

mergeTolerance 1e-06;
